<!-- Load D3.js -->
<script src="https://d3js.org/d3.v4.js"></script>

<!-- Add styles for the chart -->
<style>
  
  @media only screen and (max-width: 500px) {
    #my_dataviz_a {
      width: 100%;
      overflow-x: scroll;
    }
  }

  .legendTitle, .chartText {
    font-size: 1.2em;
  }

  .chartAxis {
    font-size: 1.5em;
  }

  text {
    font-family: "GDS Transport", arial, sans-serif;
    font-size: 1em;
  }

  .chart-title {
    font-weight: bold;
    font-size: 1.5em;
  }
  
</style>

<!-- Create a div where the graph will take place -->
<div id="my_dataviz_a"></div>

<script>
  
  // Set the dimensions and margins of the graph
  // var margin = { top: 120, right: 30, bottom: 50, left: 60 },
  // width = 600 - margin.left - margin.right,
  // height = 600 - margin.top - margin.bottom;
  var margin = { top: 120, right: 30, bottom: 40, left: 30 },
  width = 960 - margin.left - margin.right,
  height = 480 - margin.top - margin.bottom;
  
  // Append the svg object to the body of the page
  var svg1 = d3.select("#my_dataviz_a")
  .append("svg")
  .attr("width", width + margin.left + margin.right)
  .attr("height", height + margin.top + margin.bottom)
  .append("g")
  .attr("transform",
  "translate(" + margin.left + "," + margin.top + ")");
  
  // Read the data 
  d3.csv("/public/csv/population_change.csv",
  // When reading the csv, format the variables:
  function(d){
    // See https://d3js.org/d3-time-format
    return { year : d.Year, suffolk : d.Suffolk, east : d.EastOfEngland, england : d.AllEngland }
  },
  
  // Now I can use this dataset:
  function(data) {
    
    // Add X axis 
    var x = d3
    .scaleLinear()
    .domain(d3.extent(data, function(d) { return +d.year; }))
    .range([ 0, width ]);
    svg1.append("g")
    .attr("transform", "translate(0," + height + ")")
    .call(d3.axisBottom(x).tickFormat(d3.format("y")));
    
    // Add Y axis
    var y = d3.scaleLinear()
    .domain([0, d3.max(data, function(d) { return +100; })])
    // .domain([0, d3.max(data, function(d) { return +d.england; })]) - alternative domain
    .range([ height, 0 ]);
    svg1.append("g")
    .call(d3.axisLeft(y));
    
    // Add the line for Suffolk
    svg1.append("path")
    .datum(data)
    .attr("fill", "none")
    .attr("stroke", "steelblue")
    .attr('stroke-dasharray', "5,5")
    .attr("stroke-width", 3)
    .attr("d", d3.line()
    .x(function(d) { return x(d.year) })
    .y(function(d) { return y(d.suffolk) })
    )
    
    // Add the line for east of England
    svg1.append("path")
    .datum(data)
    .attr("fill", "none")
    .attr("stroke", "orange")
    .attr("stroke-width", 3)
    .attr("d", d3.line()
    .x(function(d) { return x(d.year) })
    .y(function(d) { return y(d.east) })
    )
    
    // Add the line for all England
    svg1.append("path")
    .datum(data)
    .attr("fill", "none")
    .attr("stroke", "purple")
    .attr("stroke-width", 3)
    .attr('stroke-dasharray', "3,2")
    .attr("d", d3.line()
    .x(function(d) { return x(d.year) })
    .y(function(d) { return y(d.england) })
    )

    // Chart keys
    svg1.append("line")
    .attr("stroke", "steelblue")
    .attr('stroke-dasharray', "10,5")
    .attr("stroke-width", 3)
    .attr('x1', "0%")
    .attr('x2', "3%")
    .attr('y1', "-65")
    .attr('y2', "-65")

    svg1.append("text")
    .text("18 to 64")
    .attr("x", "5%")
    .attr("y", "-60")

    svg1.append("line")
    .attr("stroke", "orange")
    .attr("stroke-width", 3)
    .attr('x1', "30%")
    .attr('x2', "33%")
    .attr('y1', "-65")
    .attr('y2', "-65")

    svg1.append("text")
    .text("65 and over")
    .attr("x", "35%")
    .attr("y", "-60")

    svg1.append("line")
    .attr("stroke", "purple")
    .attr("stroke-width", 3)
    .attr('stroke-dasharray', "3,2")
    .attr('x1', "60%")
    .attr('x2', "63%")
    .attr('y1', "-65")
    .attr('y2', "-65")

    svg1.append("text")
    .text("85 and over")
    .attr("x", "65%")
    .attr("y", "-60")
    
    // X axis legends
    svg1.append("text")
    .text("Year")
    .attr("x", width / 2)
    .attr("y", height + 40)
    
    svg1.append("text")
        .text("Graph of percentage changes for adult population age (2015 to 2023)")
    .attr("x", "-30")
    .attr("y", "-100")
    .attr("class","chart-title")
    
    svg1.append("text")
    .text("Change (%)")
    .attr("x", "-20")
    .attr("y", "-20")
  })
  
</script>