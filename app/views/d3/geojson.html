{% extends "d3/layouts/main.html" %}

{% set pageName = "JSON sandpit" %}

{% block content %}
<!-- Load d3.js -->
<script src="https://d3js.org/d3.v4.js"></script>
<!-- Leaflet JS styles -->
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
crossorigin=""/>

<!-- Make sure you put this AFTER Leaflet's CSS -->
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
crossorigin=""></script>


<style>
  #map { height: 420px; width:100%}
</style>
 
      <h1>{{pageName}}</h1>
<p>JSON is a useful format, so this page is an experiment about making JSON work with nunjucks and D3.</p>

<p>It's easy to load JSON using 'set':</p>
<!-- Example adapted from https://www.w3schools.com/whatis/whatis_json.asp -->
<!-- This example defines an employees object: an array of 3 employee records (objects): -->
{%
 set employees = [
    {"firstName":"John", "lastName":"Doe"},
    {"firstName":"Anna", "lastName":"Smith"},
    {"firstName":"Peter", "lastName":"Jones"}
]
  %}
<p>
  {% for item in employees %}
{{item.firstName}} {{item.lastName}} ... 
{% endfor %}
</p>

<!-- 

Map 
 
-->

<!-- Map div -->
<div id="map"></div>

<script>
  var map = L.map('map').setView([52.05, 0.72], 11);
  
  L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
    maxZoom: 19,
    attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'
  }).addTo(map);
  
  var marker = L.marker([52.05, 0.72], 11).addTo(map);
  marker.bindPopup("<b>Sudbury Care</b><br>Dementia beds: 8<br>All beds: 21");

  var marker2 = L.marker([52.07, 0.72], 11).addTo(map);
  marker2.bindPopup("<b>Greenfields Care</b><br>Dementia beds: 6<br>All beds: 18").openPopup();

  var marker = L.marker([52.05, 0.95], 11).addTo(map);
  marker.bindPopup("<b>Hadleigh Care</b><br>Dementia beds: 8<br>All beds: 21");

  var geojsonFeature = {
    "type": "Feature",
    "properties": {
        "name": "Test",
        "amenity": "Blah",
        "popupContent": "This is where the Rockies play!"
    },
    "geometry": {
        "type": "Point",
        "coordinates": [52.05, 0.73]
    }
};

  L.geoJSON(geojsonFeature).addTo(map);

  // geoJSON shapes
  var myLines = [{
    "type": "LineString",
    "coordinates": [[52.05, 0.72], [53.05, 0.72], [52.05, 0.82]]
}, {
    "type": "LineString",
    "coordinates": [[53.05, 0.72], [54.05, 0.72], [52.05, 0.12]]
}];

var myStyle = {
    "color": "#ff7800",
    "weight": 50,
    "opacity": 1
};

L.geoJSON(myLines, {
    style: myStyle
}).addTo(map); 

</script>

<!--

    End of Main section

    -->
{% endblock %}